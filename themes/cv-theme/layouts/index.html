{{ define "main" }}
<div class="home-font-selectors">
    <div class="home-font-selector">
        <label>Title</label>
        <select id="title-font-select">
            <option value='"Bitter", serif'>Bitter Pro</option>
            <option value='"IBM Plex Sans", sans-serif'>IBM Plex Sans</option>
        </select>
        <select id="title-weight-select">
            <option value="300" selected>300</option>
            <option value="400">400</option>
            <option value="500">500</option>
            <option value="600">600</option>
            <option value="700">700</option>
        </select>
        <select id="title-size-select">
            <option value="1.4rem">1.4</option>
            <option value="1.6rem">1.6</option>
            <option value="1.8rem">1.8</option>
            <option value="1.9rem">1.9</option>
            <option value="2.0rem">2.0</option>
            <option value="2.2rem" selected>2.2</option>
            <option value="2.5rem">2.5</option>
        </select>
    </div>
    <div class="home-font-selector">
        <label>Body</label>
        <select id="body-font-select">
            <option value='"Bitter", serif'>Bitter Pro</option>
            <option value='"IBM Plex Sans", sans-serif' selected>IBM Plex Sans</option>
        </select>
        <select id="body-weight-select">
            <option value="300">300</option>
            <option value="400" selected>400</option>
            <option value="500">500</option>
            <option value="600">600</option>
            <option value="700">700</option>
        </select>
        <select id="body-size-select">
            <option value="0.85rem">0.85</option>
            <option value="0.9rem">0.9</option>
            <option value="0.95rem">0.95</option>
            <option value="1.0rem">1.0</option>
            <option value="1.05rem">1.05</option>
            <option value="1.1rem" selected>1.1</option>
        </select>
    </div>
    <div class="home-font-selector">
        <label>Links</label>
        <select id="links-font-select">
            <option value='"JetBrains Mono", monospace'>JetBrains Mono</option>
            <option value='"Roboto Slab", serif' selected>Roboto Slab</option>
        </select>
        <select id="links-weight-select">
            <option value="300">300</option>
            <option value="400" selected>400</option>
            <option value="500">500</option>
            <option value="600">600</option>
            <option value="700">700</option>
        </select>
        <select id="links-size-select">
            <option value="0.85rem">0.85</option>
            <option value="0.9rem">0.9</option>
            <option value="0.95rem">0.95</option>
            <option value="1.0rem">1.0</option>
            <option value="1.05rem" selected>1.05</option>
            <option value="1.1rem">1.1</option>
        </select>
    </div>
</div>
<div class="home">
    <div class="home-card">
        <div class="home-card-top">
            <div class="home-info">
                <h1>Arjun Pitchanathan</h1>
                <p class="home-blurb">Hey, I'm Arjun! I work on LLM inference. Before, I did a PhD on efficient performance modeling, mentored by Tobias Grosser. My other interests include theoretical CS, AI safety, history, dancing, philosophy of mind, and the mountains.</p>
                <p class="home-blurb">I'm always happy to <a href="mailto:mail@arjunpi.com">chat</a> about anything related to these! :)</p>
            </div>
            <div class="home-photo">
                <img src="/me.jpg" alt="Arjun Pitchanathan">
            </div>
        </div>
        <div class="home-links">
            <a href="/notes">Scattered Notes</a>
            <span class="link-sep">|</span>
            <a href="https://linkedin.com/in/arjunpi" target="_blank">LinkedIn</a>
            <span class="link-sep">|</span>
            <a href="https://github.com/superty" target="_blank">Github</a>
            <span class="link-sep">|</span>
            <a href="https://arjunpi.com" id="website-link" data-click-count="0">Website</a>
            <span class="link-sep">|</span>
            <a href="https://goodreads.com/arjunp" target="_blank">Goodreads</a>
            <span class="link-sep">|</span>
            <a href="/photography">Photography</a>
        </div>
    </div>
</div>
<div class="home-spacer"></div>
<footer class="home-footer">
    Built with <a href="https://claude.ai/code" target="_blank">Claude</a> using <a href="https://gohugo.io" target="_blank">Hugo</a>.
</footer>

<script>
(function() {
    var emojiUrls = [
        'https://raw.githubusercontent.com/discord/twemoji/master/assets/72x72/1f61c.png',
        'https://raw.githubusercontent.com/discord/twemoji/master/assets/72x72/1f62e.png',
        'https://raw.githubusercontent.com/discord/twemoji/master/assets/72x72/1f635-200d-1f4ab.png'
    ];

    var link = document.getElementById('website-link');
    var clickCount = 0;

    var origWidth = link.offsetWidth;
    link.style.display = 'inline-block';
    link.style.width = origWidth + 'px';
    link.style.textAlign = 'center';

    // Preload emoji images
    emojiUrls.forEach(function(url) {
        var preload = new Image();
        preload.src = url;
    });

    function makeImg(url) {
        var img = document.createElement('img');
        img.src = url;
        img.style.height = '1.2em';
        img.style.gridArea = '1/1';
        return img;
    }

    function setEmoji(url) {
        while (link.firstChild) link.removeChild(link.firstChild);
        var img = makeImg(url);
        link.appendChild(img);
        link.classList.add('emoji-link');
        return img;
    }

    var origText = link.textContent;
    var origHref = link.href;

    function startAnimation() {
        link.style.display = 'inline-grid';
        link.style.placeItems = 'center';
        link.style.verticalAlign = 'middle';
        link.style.cursor = 'default';
        link.removeAttribute('href');
        clickCount = 2;

        // Crossfade ;P out and open mouth in
        var winkImg = link.querySelector('img');
        winkImg.style.animation = 'crossfadeOut 1s linear forwards';

        var shakenImg = makeImg(emojiUrls[1]);
        shakenImg.style.animation = 'crossfadeIn 1s linear forwards';
        link.appendChild(shakenImg);

        // After crossfade, spiral spins in then continues spinning
        setTimeout(function() {
            var spiralImg = setEmoji(emojiUrls[2]);
            spiralImg.style.animation = 'spinIn 2s linear forwards';
            setTimeout(function() {
                spiralImg.style.animation = 'spin 2s linear infinite';
                // Stop spinning after 20s
                setTimeout(function() {
                    spiralImg.style.animation = 'none';
                    // Crossfade back to ;P after 2s
                    setTimeout(function() {
                        var winkImg = makeImg(emojiUrls[0]);
                        winkImg.style.opacity = '0';
                        link.appendChild(winkImg);
                        // Force reflow then apply transitions
                        winkImg.offsetHeight;
                        spiralImg.style.transition = 'opacity 1s';
                        winkImg.style.transition = 'opacity 1s';
                        spiralImg.style.opacity = '0';
                        winkImg.style.opacity = '1';
                        setTimeout(function() {
                            spiralImg.remove();
                            link.style.cursor = 'pointer';
                            clickCount = 1;
                        }, 1000);
                    }, 2000);
                }, 20000);
            }, 2000);
        }, 10000);
    }

    // Click "Website" â†’ show ;P
    link.addEventListener('click', function(e) {
        if (clickCount === 0) {
            e.preventDefault();
            link.style.display = 'inline-grid';
            link.style.placeItems = 'center';
            link.style.verticalAlign = 'middle';
            setEmoji(emojiUrls[0]);
            link.style.cursor = 'pointer';
            link.removeAttribute('href');
            clickCount = 1;
        } else if (clickCount === 1) {
            e.preventDefault();
            startAnimation();
        }
    });

    // Middle click support
    link.addEventListener('auxclick', function(e) {
        if (e.button === 1) {
            e.preventDefault();
            if (clickCount === 0) {
                link.style.display = 'inline-grid';
                link.style.placeItems = 'center';
                link.style.verticalAlign = 'middle';
                setEmoji(emojiUrls[0]);
                link.style.cursor = 'pointer';
                link.removeAttribute('href');
                clickCount = 1;
            } else if (clickCount === 1) {
                startAnimation();
            }
        }
    });
})();

// Font selectors
var titleSelect = document.getElementById('title-font-select');
var bodySelect = document.getElementById('body-font-select');
var titleWeight = document.getElementById('title-weight-select');
var bodyWeight = document.getElementById('body-weight-select');
var titleSize = document.getElementById('title-size-select');
var bodySize = document.getElementById('body-size-select');
var linksSelect = document.getElementById('links-font-select');
var linksWeight = document.getElementById('links-weight-select');
var linksSize = document.getElementById('links-size-select');
var homeCard = document.querySelector('.home-card');

var fontPrefs = JSON.parse(localStorage.getItem('fontPrefs') || '{}');

function prefKey(role, font, prop) { return role + ':' + font + ':' + prop; }

function savePref(role, fontSelect, propSelect, prop) {
    fontPrefs[prefKey(role, fontSelect.value, prop)] = propSelect.value;
    localStorage.setItem('fontPrefs', JSON.stringify(fontPrefs));
}

function restorePref(role, fontSelect, propSelect, prop) {
    var saved = fontPrefs[prefKey(role, fontSelect.value, prop)];
    if (saved) { propSelect.value = saved; }
}

var savedTitle = localStorage.getItem('homeTitleFont');
var savedBody = localStorage.getItem('homeBodyFont');
var savedLinks = localStorage.getItem('homeLinksFont');
if (savedTitle) { titleSelect.value = savedTitle; }
if (savedBody) { bodySelect.value = savedBody; }
if (savedLinks) { linksSelect.value = savedLinks; }
restorePref('title', titleSelect, titleWeight, 'weight');
restorePref('title', titleSelect, titleSize, 'size');
restorePref('body', bodySelect, bodyWeight, 'weight');
restorePref('body', bodySelect, bodySize, 'size');
restorePref('links', linksSelect, linksWeight, 'weight');
restorePref('links', linksSelect, linksSize, 'size');

function applyFonts() {
    var h1 = homeCard.querySelector('h1');
    h1.style.fontFamily = titleSelect.value;
    h1.style.fontWeight = titleWeight.value;
    h1.style.fontSize = titleSize.value;
    homeCard.querySelectorAll('.home-blurb').forEach(function(el) {
        el.style.fontFamily = bodySelect.value;
        el.style.fontWeight = bodyWeight.value;
        el.style.fontSize = bodySize.value;
    });
    homeCard.querySelector('.home-links').style.fontFamily = linksSelect.value;
    homeCard.querySelector('.home-links').style.fontWeight = linksWeight.value;
    homeCard.querySelector('.home-links').style.fontSize = linksSize.value;
    localStorage.setItem('homeTitleFont', titleSelect.value);
    localStorage.setItem('homeBodyFont', bodySelect.value);
    localStorage.setItem('homeLinksFont', linksSelect.value);
    savePref('title', titleSelect, titleWeight, 'weight');
    savePref('title', titleSelect, titleSize, 'size');
    savePref('body', bodySelect, bodyWeight, 'weight');
    savePref('body', bodySelect, bodySize, 'size');
    savePref('links', linksSelect, linksWeight, 'weight');
    savePref('links', linksSelect, linksSize, 'size');
}
applyFonts();

titleSelect.addEventListener('change', function() {
    restorePref('title', titleSelect, titleWeight, 'weight');
    restorePref('title', titleSelect, titleSize, 'size');
    applyFonts();
});
bodySelect.addEventListener('change', function() {
    restorePref('body', bodySelect, bodyWeight, 'weight');
    restorePref('body', bodySelect, bodySize, 'size');
    applyFonts();
});
linksSelect.addEventListener('change', function() {
    restorePref('links', linksSelect, linksWeight, 'weight');
    restorePref('links', linksSelect, linksSize, 'size');
    applyFonts();
});
titleWeight.addEventListener('change', applyFonts);
bodyWeight.addEventListener('change', applyFonts);
linksWeight.addEventListener('change', applyFonts);
titleSize.addEventListener('change', applyFonts);
bodySize.addEventListener('change', applyFonts);
linksSize.addEventListener('change', applyFonts);
</script>
{{ end }}
